<html>
<head>
	<title>Froglio</title>
</head>
<body>
	<canvas id="canvas">
	</canvas>
</body>
<script type="text/javascript">
	var canvas = document.getElementById('canvas'),
		ctx = canvas.getContext('2d'),
		cx = cy = 150,
		speed = 10,
		mX = mY = theta = 0,
		food = [],
		foodRadius = 10,
		lineWidth = 5,
		radius = 60,
		space = false;

	canvas.height = window.innerHeight;
	canvas.width = window.innerWidth;
	
	spawnFood();

	function drawCharacter() {
		var amp = 1,
			sineCount = Math.floor(Math.random() * 5) + 2,
			start = Math.floor(Math.random() * 100),
			stop = start + 360;

		ctx.beginPath();

		for (var i = start; i < stop; i++) {
			var angle = i * Math.PI / 180,
		  		pt = sineCircleXYatAngle(cx, cy, radius, amp, angle, sineCount);
		  	ctx.lineTo(pt.x, pt.y);
		}

		ctx.fillStyle = '#ff80bf';
		ctx.fill();
		ctx.lineWidth = lineWidth;
		ctx.strokeStyle = '#ff4da6';
		ctx.closePath();
		ctx.stroke();
	}

	function clearMap() {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
	}

	function sineCircleXYatAngle(cx, cy, radius, amplitude, angle, sineCount){
		var x = cx + (radius + amplitude * Math.sin(sineCount * angle)) * Math.cos(angle),
			y = cy + (radius + amplitude * Math.sin(sineCount * angle)) * Math.sin(angle);
	  	return({x:x,y:y});
	}

	function update() {
		var opp = mY - cy,
			adj = mX - cx;
		theta = Math.atan(opp/adj) + (mX <= cx ? Math.PI : 0); //theta depends on quadrant
	}

	function move() {
		cy += speed * Math.sin(theta);
		cx += speed * Math.cos(theta);
	}

	function spawnFood() {
		var xPos = Math.random() * window.innerWidth,
			yPos = Math.random() * window.innerHeight,
			color = randomColor();

		food.push({
			xPos: xPos,
			yPos: yPos,
			color, color
		})

		drawFood(xPos, yPos, color);
	}

	function drawFood(xPos, yPos, color) {
		ctx.fillStyle = color;
		ctx.beginPath();
		ctx.arc(xPos, yPos, foodRadius, 0, 2 * Math.PI);
		ctx.closePath();
		ctx.fill();
	}

	function drawAllFood() {
		var radDist = radius + foodRadius;

		for (var i = 0; i < food.length; i++) {
			var actualDist = Math.sqrt(Math.pow(food[i].xPos - cx, 2) + Math.pow(food[i].yPos - cy, 2));

			if (actualDist >= radDist) {
				drawFood(food[i].xPos, food[i].yPos, food[i].color);
			} else {
				food.splice(i, 1);
				gainFood(1);
			}
		}
	}

	function gainFood(num) {
		var areaOfFood = Math.pow(foodRadius, 2) * Math.PI * num,
			areaOfCharacter = Math.pow(radius, 2) * Math.PI,
			newArea = areaOfCharacter + areaOfFood;
		radius = Math.sqrt(newArea / Math.PI);
	}

	function loseFood(num) {
		var areaOfFood = Math.pow(foodRadius, 2) * Math.PI * num,
			areaOfCharacter = Math.pow(radius, 2) * Math.PI,
			newArea = areaOfCharacter - areaOfFood;
		radius = Math.sqrt(newArea / Math.PI);
	}

	function randomColor() {
		return '#' + Math.floor(Math.random() * 16777215).toString(16);
	}

	var count = 0;

	setInterval(() => {
		count++;
		update();
		if ((Math.abs(mX - cx) > 5 || (Math.abs(mY - cy) > 5))) move(); //don't move if the mouse is basically centered on the character
		clearMap();
		drawAllFood();
		drawScore();

		if (count >= 6) {
			count = 0;
			spawnFood();
		}

		if (space && radius >= 60) {
			speed = 30;
			loseFood(1/2);
		} else {
			speed = 10;
		}

		drawCharacter();
	}, 1000 / 15)

	function drawScore() {
		ctx.font = "30px Arial";
		ctx.fillText("Mass: " + Math.floor(radius),10,50);
	}

	document.body.onmousemove = function(e) {
		mX = e.clientX;
		mY = e.clientY;
	}

	document.body.onkeyup = function(e) {
    	if (e.keyCode == 32) space = false;
	}

    document.body.onkeydown = function(e) {
    	if( e.keyCode == 32) space = true;
    }

    document.body.onresize = function(e) {
    	canvas.height = window.innerHeight;
    	canvas.width = window.innerWidth;
    }
</script>
<style type="text/css">
	* {
		border: 0;
		margin: 0;
		padding: 0;
	}
</style>
</html>