"use strict";function Map(t,a){this.width=t,this.height=a,this.bkg=document.getElementById("source")}function crds2ctx(t){var a=Game.Player.x-t.x,e=Game.Player.y-t.y;return{x:Game.View.canvas.width/2-a,y:Game.View.canvas.height/2-e}}function angleBetween(t,a){var e=a.y-t.y,o=a.x-t.x;return Math.atan(e/o)+(a.x<=t.x?Math.PI:0)}function sineCircleXYatAngle(t,a,e,o,i,n){var r=t+(e+o*Math.sin(n*i))*Math.cos(i),h=a+(e+o*Math.sin(n*i))*Math.sin(i);return{x:r,y:h}}function spawnFood(){Game.food.push(new Food)}function getDistance(t,a){return Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2))-(a.radius+t.radius)}function areOverlapping(t,a,e){return getDistance(t,a)<0-(e||0)}function randomColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}function h2r(t){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function drawAllFood(){for(var t=0;t<Game.food.length;t++)if(Game.food[t].fadeIn(.3),Game.food[t].checkForce(Game.Player),Game.food[t].draw(),Game.food[t].isEaten()&&(Game.Player.food.push(Game.food[t]),Game.food[t].color=Game.Player.color,Game.food[t].radius=.2*FOOD_RADIUS,Game.food.splice(t,1),t--),Game.Player.food[0]){Game.Player.food[0].followLeader(Game.Player),Game.Player.food[0].fadeIn(.1),Game.Player.food[0].draw();for(var a=1;a<Game.Player.food.length;a++)Game.Player.food[a].followLeader(Game.Player.food[a-1]),Game.Player.food[a].fadeIn(.1),Game.Player.food[a].draw()}}function Entity(t,a,e){this.x=t,this.y=a,this.color=randomColor(),this.radius=e}function Player(){var t=this;Entity.call(this,~~(300*Math.random()+MAP_SIZE/3),~~(300*Math.random()+MAP_SIZE/3),PLAYER_RADIUS),this.food=[],this.move=function(){t.y+=SPEED*Math.sin(theta),t.x+=SPEED*Math.cos(theta)},this.update=function(){theta=angleBetween({x:Game.View.width/2,y:Game.View.height/2},mouse)},this.draw=function(a,e){var o=1.2,i=Math.floor(5*Math.random())+3,n=Math.floor(100*Math.random()),r=n+360;ctx.beginPath();for(var h=n;r>h;h++){var s=h*Math.PI/180,c=sineCircleXYatAngle(a,e,t.radius,o,s,i);ctx.lineTo(c.x,c.y)}ctx.fillStyle=t.color,ctx.fill(),ctx.lineWidth=LINE_WIDTH,ctx.strokeStyle="rgb(r: "+h2r(t.color).r+", g: "+h2r(t.color).g+", b: "+(h2r(t.color).b+10)+")",ctx.closePath(),ctx.stroke()}}function Food(){Entity.call(this,Math.random()*Game.Map.width,Math.random()*Game.Map.height,FOOD_RADIUS),this.color=randomColor(),this.radius=.2*FOOD_RADIUS,this.draw=function(){var t=h2r(this.color);if(null!=t){var a=crds2ctx(this);ctx.fillStyle="rgba("+t.r+", "+(t.g+30)+", "+(t.b+30)+", 0.4)",ctx.beginPath(),ctx.arc(a.x,a.y,this.radius+4+1*Math.random(),0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.fillStyle=this.color,ctx.beginPath(),ctx.arc(a.x,a.y,this.radius+1*Math.random(),0,2*Math.PI),ctx.closePath(),ctx.fill()}},this.isEaten=function(){return areOverlapping(this,Game.Player,2)},this.checkForce=function(t){var a=getDistance(t,this),e=20,o=5,i=e-a+o;if(e>a){var n=angleBetween(this,t);this.y+=i*Math.sin(n),this.x+=i*Math.cos(n),this.radius=this.radius-.25*i<0?.1:this.radius-.25*i}},this.followLeader=function(t){var a=getDistance(t,this),e=20,o=e-a-SNAKINESS,i=angleBetween(this,t);this.y-=o*Math.sin(i),this.x-=o*Math.cos(i)},this.fadeIn=function(t){this.radius=this.radius<FOOD_RADIUS?this.radius+t:FOOD_RADIUS}}function death(t){}function move(t){}function View(){var t=this;this.canvas=document.createElement("canvas"),window.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width=window.innerWidth,this.canvas.height=this.height=window.innerHeight,document.body.appendChild(this.canvas),this.resize=function(){t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight},this.follow=function(){document.getElementById("source")},this.draw=function(){ctx.fillStyle="#ff99cc",ctx.fillRect(0,0,t.canvas.width,t.canvas.height);var a=document.getElementById("source");ctx.drawImage(a,Game.Player.x,Game.Player.y,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height),drawAllFood(),Game.Player.draw(t.width/2,t.height/2)}}var Game={},SPEED=3,MAP_SIZE=4e3,FOOD_RADIUS=8,LINE_WIDTH=5,PLAYER_RADIUS=30,SNAKINESS=10,CTX=null,theta=0,mouse={x:0,y:0},PLAYER=new Player;Game.Map=new Map(4e3,4e3),Game.View=new View,Game.Player=new Player,Game.food=[],document.body.onmousemove=function(t){mouse.x=t.clientX,mouse.y=t.clientY},setInterval(function(){Game.Player.update(),Game.Player.move(),Game.View.follow(),Game.View.draw()},1e3/60),setInterval(function(){Game.food.push(new Food),console.log("pushed!")},1e3),setInterval(function(){console.log(Game.Player)},3e3);var ws=new WebSocket("ws://localhost:80");ws.onmessage=function(t){var a=JSON.parse(t);switch(a.id){case"0x01":death(a);break;case"0x02":move(a)}};