"use strict";function Map(t,e){this.width=t,this.height=e,this.bkg=document.getElementById("source")}function crds2ctx(t){var e=Game.Player.x-t.x,a=Game.Player.y-t.y;return{x:Game.View.canvas.width/2-e,y:Game.View.canvas.height/2-a}}function angleBetween(t,e){var a=e.y-t.y,o=e.x-t.x;return Math.atan(a/o)+(e.x<=t.x?Math.PI:0)}function sineCircleXYatAngle(t,e,a,o,i,n){var r=t+(a+o*Math.sin(n*i))*Math.cos(i),h=e+(a+o*Math.sin(n*i))*Math.sin(i);return{x:r,y:h}}function spawnFood(){Game.food.push(new Food)}function getDistance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))-(e.radius+t.radius)}function areOverlapping(t,e,a){return getDistance(t,e)<0-(a||0)}function randomColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}function h2r(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function drawAllFood(){for(var t=0;t<Game.food.length;t++)Game.food[t].fadeIn(.3),Game.food[t].checkForce(Game.Player),Game.food[t].draw(),Game.food[t].isEaten()&&(Game.Player.food.push(Game.food[t]),Game.food[t].color=Game.Player.color,Game.food[t].radius=.2*FOOD_RADIUS,Game.food.splice(t,1),t--);if(Game.Player.food[0]){Game.Player.food[0].followLeader(Game.Player),Game.Player.food[0].fadeIn(.1),Game.Player.food[0].draw();for(var e=1;e<Game.Player.food.length;e++)Game.Player.food[e].followLeader(Game.Player.food[e-1]),Game.Player.food[e].fadeIn(.1),Game.Player.food[e].draw()}}function Entity(t,e,a){this.x=t,this.y=e,this.color=randomColor(),this.radius=a}function Player(){var t=this;Entity.call(this,~~(300*Math.random()+MAP_SIZE/3),~~(300*Math.random()+MAP_SIZE/3),PLAYER_RADIUS),this.food=[],this.move=function(){t.y+=SPEED*Math.sin(theta),t.x+=SPEED*Math.cos(theta)},this.update=function(){theta=angleBetween({x:Game.View.width/2,y:Game.View.height/2},mouse)},this.draw=function(e,a){var o=1.2,i=Math.floor(5*Math.random())+3,n=Math.floor(100*Math.random()),r=n+360;ctx.beginPath();for(var h=n;r>h;h++){var s=h*Math.PI/180,c=sineCircleXYatAngle(e,a,t.radius,o,s,i);ctx.lineTo(c.x,c.y)}ctx.fillStyle=t.color,ctx.fill(),ctx.lineWidth=LINE_WIDTH,ctx.strokeStyle="rgb(r: "+h2r(t.color).r+", g: "+h2r(t.color).g+", b: "+(h2r(t.color).b+10)+")",ctx.closePath(),ctx.stroke()}}function Food(){Entity.call(this,Math.random()*Game.Map.width,Math.random()*Game.Map.height,FOOD_RADIUS),this.color=randomColor(),this.radius=.2*FOOD_RADIUS,this.draw=function(){var t=h2r(this.color);if(null!=t){var e=crds2ctx(this);ctx.fillStyle="rgba("+t.r+", "+(t.g+30)+", "+(t.b+30)+", 0.4)",ctx.beginPath(),ctx.arc(e.x,e.y,this.radius+4+1*Math.random(),0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.fillStyle=this.color,ctx.beginPath(),ctx.arc(e.x,e.y,this.radius+1*Math.random(),0,2*Math.PI),ctx.closePath(),ctx.fill()}},this.isEaten=function(){return areOverlapping(this,Game.Player,2)},this.checkForce=function(t){var e=getDistance(t,this),a=20,o=5,i=a-e+o;if(a>e){var n=angleBetween(this,t);this.y+=i*Math.sin(n),this.x+=i*Math.cos(n),this.radius=this.radius-.25*i<0?.1:this.radius-.25*i}},this.followLeader=function(t){var e=getDistance(t,this),a=20,o=a-e-SNAKINESS,i=angleBetween(this,t);this.y-=o*Math.sin(i),this.x-=o*Math.cos(i)},this.fadeIn=function(t){this.radius=this.radius<FOOD_RADIUS?this.radius+t:FOOD_RADIUS}}function death(t){}function move(t){}function View(){var t=this,e=document.getElementById("source");this.canvas=document.createElement("canvas"),window.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width=window.innerWidth,this.canvas.height=this.height=window.innerHeight,document.body.appendChild(this.canvas),this.resize=function(){t.canvas.width=t.width=window.innerWidth,t.canvas.height=t.height=window.innerHeight},this.draw=function(){ctx.fillStyle="#ff99cc",ctx.fillRect(0,0,t.canvas.width,t.canvas.height),ctx.drawImage(e,Game.Player.x-t.width/2,Game.Player.y-t.height/2,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height),drawAllFood(),Game.Player.draw(t.width/2,t.height/2)}}var Game={},SPEED=3,MAP_SIZE=4e3,FOOD_RADIUS=8,LINE_WIDTH=5,PLAYER_RADIUS=30,SNAKINESS=10,CTX=null,theta=0,mouse={x:0,y:0},PLAYER=new Player;Game.Map=new Map(4e3,4e3),Game.View=new View,Game.Player=new Player,Game.food=[],document.body.onmousemove=function(t){mouse.x=t.clientX,mouse.y=t.clientY},window.onresize=function(t){return Game.View.resize()},setInterval(function(){Game.Player.update(),Game.Player.move(),Game.View.draw()},1e3/60),setInterval(function(){Game.food.push(new Food)},1e3),setInterval(function(){console.log(Game.Player)},3e3);var ws=new WebSocket("ws://localhost:3000","echo-protocol");ws.onmessage=function(t){console.log(t)};