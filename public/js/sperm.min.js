"use strict";function Map(t,e){this.width=t,this.height=e,this.bkg=document.getElementById("source")}function crds2ctx(t){var e=Game.Player.x-t.x,a=Game.Player.y-t.y;return{x:Game.View.canvas.width/2-e,y:Game.View.canvas.height/2-a}}function angleBetween(t,e){var a=e.y-t.y,o=e.x-t.x;return Math.atan(a/o)+(e.x<=t.x?Math.PI:0)}function sineCircleXYatAngle(t,e,a,o,i,n){var r=t+(a+o*Math.sin(n*i))*Math.cos(i),h=e+(a+o*Math.sin(n*i))*Math.sin(i);return{x:r,y:h}}function spawnFood(){Game.food.push(new Food)}function getDistance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))-(e.radius+t.radius)}function areOverlapping(t,e,a){return getDistance(t,e)<0-(a||0)}function randomColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}function h2r(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function drawAllFood(){for(var t=0;t<Game.food.length;t++)Game.food[t].radius=Game.food[t].radius<FOOD_RADIUS?Game.food[t].radius+.3:FOOD_RADIUS,Game.food[t].chained||Game.food[t].checkForce(Game.Player),Game.food[t].draw();Game.Player.food[0]&&Game.Player.food[0].checkForce(Game.Player);for(var t=1;t<Game.Player.food.length;t++)Game.Player.food[t]&&Game.Player.food[t].checkForce(Game.Player.food[t-1])}function Entity(t,e,a){this.x=t,this.y=e,this.color=randomColor(),this.radius=a}function Player(){var t=this;Entity.call(this,~~(300*Math.random()+MAP_SIZE/3),~~(300*Math.random()+MAP_SIZE/3),PLAYER_RADIUS),this.food=[],this.move=function(){t.y+=SPEED*Math.sin(theta),t.x+=SPEED*Math.cos(theta)},this.update=function(){theta=angleBetween({x:Game.View.width/2,y:Game.View.height/2},mouse)},this.draw=function(e,a){var o=1.2,i=Math.floor(5*Math.random())+3,n=Math.floor(100*Math.random()),r=n+360;ctx.beginPath();for(var h=n;r>h;h++){var c=h*Math.PI/180,s=sineCircleXYatAngle(e,a,t.radius,o,c,i);ctx.lineTo(s.x,s.y)}ctx.fillStyle=t.color,ctx.fill(),ctx.lineWidth=LINE_WIDTH,ctx.strokeStyle="rgb(r: "+h2r(t.color).r+", g: "+h2r(t.color).g+", b: "+(h2r(t.color).b+10)+")",ctx.closePath(),ctx.stroke()}}function Food(){Entity.call(this,Math.random()*Game.Map.width,Math.random()*Game.Map.height,FOOD_RADIUS),this.color=randomColor(),this.radius=.2*FOOD_RADIUS,this.chained=!1,this.draw=function(){var t=h2r(this.color);if(null!=t){var e=crds2ctx(this);ctx.fillStyle="rgba("+t.r+", "+(t.g+30)+", "+(t.b+30)+", 0.4)",ctx.beginPath(),ctx.arc(e.x,e.y,this.radius+4+1*Math.random(),0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.fillStyle=this.color,ctx.beginPath(),ctx.arc(e.x,e.y,this.radius+1*Math.random(),0,2*Math.PI),ctx.closePath(),ctx.fill()}},this.checkForce=function(t){var e=getDistance(t,this);if(this.chained){var a=angleBetween(this,t);return this.y-=(16-e)*Math.sin(a),void(this.x-=(16-e)*Math.cos(a))}if(20>e){var a=angleBetween(this,t);this.y-=(16-e)*Math.sin(a),this.x-=(16-e)*Math.cos(a)}15>e&&!this.chained&&(Game.Player.food.push(this),this.chained=!0,this.radius=.2*FOOD_RADIUS,this.color=Game.Player.color)}}function death(t){}function move(t){}function View(){var t=this;this.canvas=document.createElement("canvas"),window.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width=window.innerWidth,this.canvas.height=this.height=window.innerHeight,document.body.appendChild(this.canvas),this.resize=function(){t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight},this.follow=function(){document.getElementById("source")},this.draw=function(){ctx.fillStyle="#ff99cc",ctx.fillRect(0,0,t.canvas.width,t.canvas.height);var e=document.getElementById("source");ctx.drawImage(e,Game.Player.x,Game.Player.y,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height),drawAllFood(),Game.Player.draw(t.width/2,t.height/2)}}var Game={},SPEED=3,MAP_SIZE=4e3,FOOD_RADIUS=8,LINE_WIDTH=5,PLAYER_RADIUS=30,CTX=null,theta=0,mouse={x:0,y:0},PLAYER=new Player;Game.Map=new Map(4e3,4e3),Game.View=new View,Game.Player=new Player,Game.food=[],document.body.onmousemove=function(t){mouse.x=t.clientX,mouse.y=t.clientY},setInterval(function(){Game.Player.update(),Game.Player.move(),Game.View.follow(),Game.View.draw()},1e3/60),setInterval(function(){Game.food.push(new Food),console.log("pushed!")},1e3),setInterval(function(){console.log(Game.Player)},3e3);var ws=new WebSocket("ws://localhost:80");ws.onmessage=function(t){var e=JSON.parse(t);switch(e.id){case"0x01":death(e);break;case"0x02":move(e)}};